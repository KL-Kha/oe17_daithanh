<templates>

<t t-name="web_studio.ReportEditorWysiwyg">
    <t t-call="web_studio.ReportEditorWysiwyg.Sidebar" />
    <div class="o-web-studio-report-editor-wysiwyg h-100 w-100 position-relative">
      <UndoRedo state="undoRedoState"/>
      <ReportEditorIframe iframeKey="reportEditorModel.reportQweb || ''" iframeSource="reportQweb" onIframeLoaded.bind="onIframeLoaded" />
      <Wysiwyg t-if="state.wysiwygKey and this.iframeRef?.el" t-key="state.wysiwygKey" t-props="wysiwygProps" />
    </div>
</t>

<t t-name="web_studio.ReportEditorWysiwyg.Sidebar" >
    <div class="o_web_studio_sidebar h-100 overflow-auto flex-grow-0 flex-shrink-0" style="flex-basis: 300px;">
      <div class="o_web_studio_sidebar_content d-flex flex-column gap-3 mt-3">
        <Record t-props="reportRecordProps" t-slot-scope="scope" onRecordChanged.alike="(rec) => this.reportEditorModel.reportData = rec.data">
          <t t-set="record" t-value="scope.record" />

          <div class="o_web_studio_sidebar_text">
            <label for="name" class="mb-1">Report name</label>
            <CharField name="'name'" record="record" id="'name'"/>
          </div>

          <div class="o_web_studio_sidebar_tags">
            <label for="paperformat_id" class="mb-1">Paper format</label>
            <Many2OneField record="record" name="'paperformat_id'" id="'paperformat_id'"/>
          </div>

          <div class="o_web_studio_sidebar_checkbox d-flex flex-row gap-1">
            <BooleanField record="record" name="'display_in_print_menu'" id="'display_in_print_menu'"/>
            <label for="display_in_print_menu">Show in print menu</label>
          </div>

          <div class="o_web_studio_sidebar_checkbox d-flex flex-row gap-1">
            <BooleanField record="record" name="'attachment_use'" id="'attachment_use'"/>
            <label for="attachment_use">Reload from attachment</label>
          </div>

          <div class="o_web_studio_sidebar_tags">
            <label for="groups_id" class="mb-1">Limit visibility to groups</label>
            <div class="o_field_widget o_field_many2many_tags" name="groups_id">
              <Many2ManyTagsField id="'groups_id'" name="'groups_id'" record="record"/>
            </div>
          </div>

        </Record>
        <div class="grid gap-2 mt-4 pt-3 border-top border-secondary">
          <button class="btn btn-info g-col-6 p-2" name="report_edit_sources" t-on-click="editSources">
            <i class="fa fa-code me-2" />Edit sources
          </button>
          <button class="btn btn-danger g-col-6 p-2" name="report_reset_archs" t-on-click="resetReport">
            Reset report
          </button>
          <button class="btn btn-secondary g-col-6 p-2" name="report_print_preview" t-on-click="printPreview">
            <i class="fa fa-print me-2" />Print preview
          </button>
          <button class="btn btn-secondary g-col-6 p-2" t-if="env.debug" t-on-click="openReportFormView">
            <i class="fa fa-cog me-2" />More
          </button>
        </div>
      </div>
    </div>
</t>

<t t-name="web_studio.FieldDynamicPlaceholder">
  <div class="o-web-studio-field-dynamic-placeholder">
    <div class="m-3" style="max-width: 240px;" t-if="Object.keys(sortedVariables).length > 1">
      <h6 class="d-inline">Select the report's variable for the field:</h6>
      <span class="ms-1">('doc' or 'o' are recommended)</span>
      <div class="d-flex flex-row gap-2 flex-wrap mt-2 o-web-studio-report-field-qweb-selector">
        <div t-foreach="sortedVariables" t-as="qwebVar" t-key="qwebVar" t-att-selected="qwebVar === state.currentVar" class="border border-primary border-1 rounded-pill px-2 cursor-pointer" t-on-click="() => state.currentVar = qwebVar" t-att-data-tooltip="qwebVar_value.model">
          <span>
            <t t-esc="qwebVar" /> (<t t-esc="qwebVar_value.name" />)
          </span>
        </div>
      </div>
    </div>
    <DynamicPlaceholderPopover resModel="currentResModel" validate.bind="validate" close="props.close" t-key="currentResModel"/>
  </div>
</t>

<t t-name="web_studio.ReportEditorWysiwyg.UndoRedo">
  <t t-set="isActive" t-value="props.state.canUndo or props.state.canRedo" />
  <div class="position-absolute top-0 start-0 ms-5 mt-4 rounded-pill bg-white border border-2 d-flex flex-row o-web-studio-report-editor-undo-redo gap-2 align-items-center" t-att-class="{active: isActive}">
    <button class="btn o_web_studio_undo_redo_button text-uppercase" t-attf-class="{{ !props.state.canUndo ? 'text-muted' : 'active' }}" t-on-click="props.state.undo">
      <i class="fa fa-undo me-1"/>Undo
    </button>
    <div class="border" />
    <button class="btn o_web_studio_undo_redo_button text-uppercase" t-attf-class="{{ !props.state.canRedo ? 'text-muted' : 'active' }}" t-on-click="props.state.redo">
      <i class="fa fa-repeat me-1"/>Redo
    </button>
  </div>
</t>

</templates>
